//©///////////////////////////////////////////////////////////////////////////©//
//
//  Copyright 2021-2025 BIA-Technologies Limited Liability Company
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//
//©///////////////////////////////////////////////////////////////////////////©//

#Область СлужебныйПрограммныйИнтерфейс

// Регистрация тестовых сценариев для выполнения
Процедура ИсполняемыеСценарии() Экспорт
	
	ЮТТесты
		// Тесты методов получения ключей
		.ДобавитьТест("КлючЗапуска")
		.ДобавитьТест("КлючЗапускаНРег")
		
		// Тесты получения параметров по умолчанию
		.ДобавитьТест("ПараметрыТестированияПоУмолчанию")
		
		// Тесты парсинга параметров запуска предприятия
		.ДобавитьТест("ПараметрыЗапускаПредприятия_СПараметромTrue")
		.ДобавитьТест("ПараметрыЗапускаПредприятия_СПутемКФайлу")
		.ДобавитьТест("ПараметрыЗапускаПредприятия_СБулевымЗначением")
		.ДобавитьТест("ПараметрыЗапускаПредприятия_ПустаяСтрока")
		
		// Тесты определения переданных параметров
		.ДобавитьТест("ПереданныеПараметрыТестирования_БулевоИстина")
		.ДобавитьТест("ПереданныеПараметрыТестирования_БулевоЛожь")
		.ДобавитьТест("ПереданныеПараметрыТестирования_СтрокаTrue")
		.ДобавитьТест("ПереданныеПараметрыТестирования_СтрокаFalse")
		
		// Тесты парсинга дополнительных параметров
		.ДобавитьТест("ПарсингДополнительныхПараметров_БезДополнительныхПараметров")
		.ДобавитьТест("ПарсингДополнительныхПараметров_СДополнительнымиПараметрами")
		
		// Тесты слияния параметров
		.ДобавитьТест("СлитьПараметры")
		
		// Тесты преобразования значений
		.ДобавитьТест("ПреобразоватьЗначениеПараметра_СтрокаTrue")
		.ДобавитьТест("ПреобразоватьЗначениеПараметра_СтрокаFalse")
		.ДобавитьТест("ПреобразоватьЗначениеПараметра_БулевоИстина")
		.ДобавитьТест("ПреобразоватьЗначениеПараметра_БулевоЛожь")
		.ДобавитьТест("ПреобразоватьЗначениеПараметра_Число")
		.ДобавитьТест("ПреобразоватьЗначениеПараметра_ЧислоДробное")
		.ДобавитьТест("ПреобразоватьЗначениеПараметра_ОбычнаяСтрока")
		.ДобавитьТест("ПреобразоватьЗначениеПараметра_БулевоДа")
		
		// Тесты разрешения путей
		.ДобавитьТест("РазрешитьОтносительныйПуть_ОтносительныйПуть")
		.ДобавитьТест("РазрешитьОтносительныйПуть_АбсолютныйПутьWindows")
		.ДобавитьТест("РазрешитьОтносительныйПуть_АбсолютныйПутьUnix")
		.ДобавитьТест("РазрешитьОтносительныйПуть_ПустойПуть");
		
КонецПроцедуры

#КонецОбласти

#Область ПрограммныйИнтерфейс

// Тест получения ключа запуска
//
Процедура КлючЗапуска() Экспорт
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.КлючЗапуска();
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "КлючЗапуска должен возвращать строку")
		.ИмеетТип("Строка")
		.НеРавно("");
	
КонецПроцедуры

// Тест получения ключа запуска в нижнем регистре
//
Процедура КлючЗапускаНРег() Экспорт
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.КлючЗапускаНРег();
	КлючЗапуска = ЮТПараметрыЗапускаСлужебный.КлючЗапуска();
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "КлючЗапускаНРег")
		.ИмеетТип("Строка")
		.Равно(НРег(КлючЗапуска));
	
КонецПроцедуры

// Тест получения параметров тестирования по умолчанию
//
Процедура ПараметрыТестированияПоУмолчанию() Экспорт
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПараметрыТестированияПоУмолчанию();
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "ПараметрыТестированияПоУмолчанию должны возвращать структуру")
		.ИмеетТип("Структура");
	
КонецПроцедуры

#КонецОбласти

#Область ТестыПарсингаПараметровЗапуска

// Тест парсинга параметров запуска с параметром true
//
Процедура ПараметрыЗапускаПредприятия_СПараметромTrue() Экспорт
	
	// Подготовка данных
	ПараметрыСтрокой = "RunUnitTests=true";
	ОжидаемыйКлюч = "rununittests";
	ОжидаемоеЗначение = "true";
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПараметрыЗапускаПредприятия(ПараметрыСтрокой);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Результат должен быть соответствием")
		.ИмеетТип("Соответствие");
	
	ЮТест.ОжидаетЧто(Результат.Получить(ОжидаемыйКлюч) <> Неопределено, "Должен содержать ключ " + ОжидаемыйКлюч)
		.Равно(Истина);
		
	ЮТест.ОжидаетЧто(Результат[ОжидаемыйКлюч], "Значение параметра")
		.Равно(ОжидаемоеЗначение);
	
КонецПроцедуры

// Тест парсинга параметров запуска с путем к файлу
//
Процедура ПараметрыЗапускаПредприятия_СПутемКФайлу() Экспорт
	
	// Подготовка данных
	ПараметрыСтрокой = "RunUnitTests=/path/to/config.json";
	ОжидаемыйКлюч = "rununittests";
	ОжидаемоеЗначение = "/path/to/config.json";
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПараметрыЗапускаПредприятия(ПараметрыСтрокой);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Результат должен быть соответствием")
		.ИмеетТип("Соответствие");
		
	ЮТест.ОжидаетЧто(Результат.Получить(ОжидаемыйКлюч), "Значение параметра")
		.Равно(ОжидаемоеЗначение);
	
КонецПроцедуры

// Тест парсинга параметров запуска с булевым значением
//
Процедура ПараметрыЗапускаПредприятия_СБулевымЗначением() Экспорт
	
	// Подготовка данных
	ПараметрыСтрокой = "RunUnitTests;OtherParam=value";
	ОжидаемыйКлюч = "rununittests";
	ОжидаемоеЗначение = Истина;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПараметрыЗапускаПредприятия(ПараметрыСтрокой);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Результат должен быть соответствием")
		.ИмеетТип("Соответствие");
		
	ЮТест.ОжидаетЧто(Результат.Получить(ОжидаемыйКлюч), "Значение параметра")
		.Равно(ОжидаемоеЗначение);
	
КонецПроцедуры

// Тест парсинга пустой строки параметров
//
Процедура ПараметрыЗапускаПредприятия_ПустаяСтрока() Экспорт
	
	// Подготовка данных
	ПараметрыСтрокой = "";
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПараметрыЗапускаПредприятия(ПараметрыСтрокой);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Результат должен быть соответствием")
		.ИмеетТип("Соответствие");
	
КонецПроцедуры

#КонецОбласти

#Область ТестыПереданныхПараметров

// Тест определения переданных параметров - булево Истина
//
Процедура ПереданныеПараметрыТестирования_БулевоИстина() Экспорт
	
	// Подготовка данных
	ПараметрыЗапуска = Новый Соответствие;
	ПараметрыЗапуска.Вставить("rununittests", Истина);
	ОжидаемоеЗначениеВыполнять = Истина;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПереданныеПараметрыТестирования(ПараметрыЗапуска);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат.Свойство("ВыполнятьМодульноеТестирование"), "Должно содержать свойство ВыполнятьМодульноеТестирование")
		.Равно(Истина);
		
	ЮТест.ОжидаетЧто(Результат.ВыполнятьМодульноеТестирование, "Значение ВыполнятьМодульноеТестирование")
		.Равно(ОжидаемоеЗначениеВыполнять);
	
КонецПроцедуры

// Тест определения переданных параметров - булево Ложь
//
Процедура ПереданныеПараметрыТестирования_БулевоЛожь() Экспорт
	
	// Подготовка данных
	ПараметрыЗапуска = Новый Соответствие;
	ПараметрыЗапуска.Вставить("rununittests", Ложь);
	ОжидаемоеЗначениеВыполнять = Ложь;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПереданныеПараметрыТестирования(ПараметрыЗапуска);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат.ВыполнятьМодульноеТестирование, "Значение ВыполнятьМодульноеТестирование")
		.Равно(ОжидаемоеЗначениеВыполнять);
	
КонецПроцедуры

// Тест определения переданных параметров - строка "true"
//
Процедура ПереданныеПараметрыТестирования_СтрокаTrue() Экспорт
	
	// Подготовка данных
	ПараметрыЗапуска = Новый Соответствие;
	ПараметрыЗапуска.Вставить("rununittests", "true");
	ОжидаемоеЗначениеВыполнять = Истина;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПереданныеПараметрыТестирования(ПараметрыЗапуска);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат.ВыполнятьМодульноеТестирование, "Значение ВыполнятьМодульноеТестирование")
		.Равно(ОжидаемоеЗначениеВыполнять);
	
КонецПроцедуры

// Тест определения переданных параметров - строка "false"
//
Процедура ПереданныеПараметрыТестирования_СтрокаFalse() Экспорт
	
	// Подготовка данных
	ПараметрыЗапуска = Новый Соответствие;
	ПараметрыЗапуска.Вставить("rununittests", "false");
	ОжидаемоеЗначениеВыполнять = Ложь;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПереданныеПараметрыТестирования(ПараметрыЗапуска);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат.ВыполнятьМодульноеТестирование, "Значение ВыполнятьМодульноеТестирование")
		.Равно(ОжидаемоеЗначениеВыполнять);
	
КонецПроцедуры

#КонецОбласти

#Область ТестыПарсингаДополнительныхПараметров

// Тест парсинга дополнительных параметров - без дополнительных параметров
//
Процедура ПарсингДополнительныхПараметров_БезДополнительныхПараметров() Экспорт
	
	// Подготовка данных
	ПараметрыЗапуска = Новый Соответствие;
	ПараметрыЗапуска.Вставить("rununittests", Истина);
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПарсингДополнительныхПараметров(ПараметрыЗапуска);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Результат должен быть структурой")
		.ИмеетТип("Структура");
	
КонецПроцедуры

// Тест парсинга дополнительных параметров - с дополнительными параметрами
//
Процедура ПарсингДополнительныхПараметров_СДополнительнымиПараметрами() Экспорт
	
	// Подготовка данных
	ПараметрыЗапуска = Новый Соответствие;
	ПараметрыЗапуска.Вставить("rununittests", Истина);
	ПараметрыЗапуска.Вставить("additionalParam", "value");
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПарсингДополнительныхПараметров(ПараметрыЗапуска);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Результат должен быть структурой")
		.ИмеетТип("Структура");
		
	ЮТест.ОжидаетЧто(Результат.Свойство("additionalParam"), "Должен содержать дополнительный параметр")
		.Равно(Истина);
	
КонецПроцедуры

#КонецОбласти

#Область ТестыСлиянияПараметров

// Тест слияния параметров
//
Процедура СлитьПараметры() Экспорт
	
	// Подготовка данных
	БазовыеПараметры = Новый Структура;
	БазовыеПараметры.Вставить("ПараметрБаза", "ЗначениеБаза");
	БазовыеПараметры.Вставить("ОбщийПараметр", "ЗначениеБаза");
	
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("ПараметрДополнительный", "ЗначениеДополнительное");
	ДополнительныеПараметры.Вставить("ОбщийПараметр", "ЗначениеДополнительное");
	
	// Выполнение
	ЮТПараметрыЗапускаСлужебный.СлитьПараметры(БазовыеПараметры, ДополнительныеПараметры);
	
	// Проверки
	ЮТест.ОжидаетЧто(БазовыеПараметры.Свойство("ПараметрБаза"), "Должен содержать базовый параметр")
		.Равно(Истина);
		
	ЮТест.ОжидаетЧто(БазовыеПараметры.Свойство("ПараметрДополнительный"), "Должен содержать дополнительный параметр")
		.Равно(Истина);
		
	ЮТест.ОжидаетЧто(БазовыеПараметры.ОбщийПараметр, "Общий параметр должен быть перезаписан")
		.Равно("ЗначениеДополнительное");
	
КонецПроцедуры

#КонецОбласти

#Область ТестыПреобразованияЗначений

// Тест преобразования значения параметра - строка "true"
//
Процедура ПреобразоватьЗначениеПараметра_СтрокаTrue() Экспорт
	
	// Подготовка данных
	ВходноеЗначение = "true";
	ОжидаемыйРезультат = Истина;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПреобразоватьЗначениеПараметра(ВходноеЗначение);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Преобразование строки 'true'")
		.Равно(ОжидаемыйРезультат);
	
КонецПроцедуры

// Тест преобразования значения параметра - строка "false"
//
Процедура ПреобразоватьЗначениеПараметра_СтрокаFalse() Экспорт
	
	// Подготовка данных
	ВходноеЗначение = "false";
	ОжидаемыйРезультат = Ложь;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПреобразоватьЗначениеПараметра(ВходноеЗначение);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Преобразование строки 'false'")
		.Равно(ОжидаемыйРезультат);
	
КонецПроцедуры

// Тест преобразования значения параметра - булево Истина
//
Процедура ПреобразоватьЗначениеПараметра_БулевоИстина() Экспорт
	
	// Подготовка данных
	ВходноеЗначение = Истина;
	ОжидаемыйРезультат = Истина;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПреобразоватьЗначениеПараметра(ВходноеЗначение);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Преобразование булево Истина")
		.Равно(ОжидаемыйРезультат);
	
КонецПроцедуры

// Тест преобразования значения параметра - булево Ложь
//
Процедура ПреобразоватьЗначениеПараметра_БулевоЛожь() Экспорт
	
	// Подготовка данных
	ВходноеЗначение = Ложь;
	ОжидаемыйРезультат = Ложь;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПреобразоватьЗначениеПараметра(ВходноеЗначение);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Преобразование булево Ложь")
		.Равно(ОжидаемыйРезультат);
	
КонецПроцедуры

// Тест преобразования значения параметра - число
//
Процедура ПреобразоватьЗначениеПараметра_Число() Экспорт
	
	// Подготовка данных
	ВходноеЗначение = 123;
	ОжидаемыйРезультат = 123;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПреобразоватьЗначениеПараметра(ВходноеЗначение);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Преобразование числа")
		.Равно(ОжидаемыйРезультат);
	
КонецПроцедуры

// Тест преобразования значения параметра - дробное число
//
Процедура ПреобразоватьЗначениеПараметра_ЧислоДробное() Экспорт
	
	// Подготовка данных
	ВходноеЗначение = 123.45;
	ОжидаемыйРезультат = 123.45;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПреобразоватьЗначениеПараметра(ВходноеЗначение);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Преобразование дробного числа")
		.Равно(ОжидаемыйРезультат);
	
КонецПроцедуры

// Тест преобразования значения параметра - обычная строка
//
Процедура ПреобразоватьЗначениеПараметра_ОбычнаяСтрока() Экспорт
	
	// Подготовка данных
	ВходноеЗначение = "строка";
	ОжидаемыйРезультат = "строка";
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПреобразоватьЗначениеПараметра(ВходноеЗначение);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Преобразование обычной строки")
		.Равно(ОжидаемыйРезультат);
	
КонецПроцедуры

// Тест преобразования значения параметра - булево Да
//
Процедура ПреобразоватьЗначениеПараметра_БулевоДа() Экспорт
	
	// Подготовка данных
	ВходноеЗначение = Истина;
	ОжидаемыйРезультат = Истина;
	
	// Выполнение
	Результат = ЮТПараметрыЗапускаСлужебный.ПреобразоватьЗначениеПараметра(ВходноеЗначение);
	
	// Проверки
	ЮТест.ОжидаетЧто(Результат, "Преобразование булево Да")
		.Равно(ОжидаемыйРезультат);
	
КонецПроцедуры

#КонецОбласти

#Область ТестыРазрешенияПутей

// Тест разрешения относительного пути
//
Процедура РазрешитьОтносительныйПуть_ОтносительныйПуть() Экспорт
	
	// Подготовка данных
	Путь = "reports/test.xml";
	WorkspacePath = ЮТест.Данные().СлучайнаяСтрока(20);
	ProjectPath = ЮТест.Данные().СлучайнаяСтрока(20);
	
	// Выполнение
	#Если НЕ ВебКлиент Тогда
		Результат = ЮТПараметрыЗапускаСлужебный.РазрешитьОтносительныйПуть(Путь, WorkspacePath, ProjectPath);
	#Иначе
		Результат = ЮТПараметрыЗапускаСлужебный.РазрешитьОтносительныйПуть(Путь, WorkspacePath);
	#КонецЕсли
	
	// Проверки - относительный путь должен быть дополнен путем рабочей директории
	#Если НЕ ВебКлиент Тогда
		ЮТест.ОжидаетЧто(Результат, "РазрешитьОтносительныйПуть для относительного пути")
			.НеРавно(Путь);
	#Иначе
		ЮТест.ОжидаетЧто(Результат, "РазрешитьОтносительныйПуть в веб-клиенте")
			.Равно(Путь);
	#КонецЕсли
	
КонецПроцедуры

// Тест разрешения абсолютного пути Windows
//
Процедура РазрешитьОтносительныйПуть_АбсолютныйПутьWindows() Экспорт
	
	// Подготовка данных - создаем абсолютный путь Windows для тестирования
	ДискБуква = ЮТест.Данные().СлучайнаяСтрока(1, "CDEF");
	ПапкаИмя = ЮТест.Данные().СлучайнаяСтрока(8);
	ФайлИмя = ЮТест.Данные().СлучайнаяСтрока(8);
	Путь = ДискБуква + ":\" + ПапкаИмя + "\" + ФайлИмя + ".xml";
	WorkspacePath = ЮТест.Данные().СлучайнаяСтрока(20);
	
	// Выполнение
	#Если НЕ ВебКлиент Тогда
		Результат = ЮТПараметрыЗапускаСлужебный.РазрешитьОтносительныйПуть(Путь, WorkspacePath);
		
		// Проверки - на Linux абсолютные Windows пути обрабатываются как относительные
		// Это нормальное поведение, так как тест выполняется на Linux сервере
		ЮТест.ОжидаетЧто(Результат, "РазрешитьОтносительныйПуть абсолютный Windows на Linux")
			.ИмеетТип("Строка");
	#Иначе
		Результат = ЮТПараметрыЗапускаСлужебный.РазрешитьОтносительныйПуть(Путь, WorkspacePath);
		
		ЮТест.ОжидаетЧто(Результат, "РазрешитьОтносительныйПуть в веб-клиенте")
			.Равно(Путь);
	#КонецЕсли
	
КонецПроцедуры

// Тест разрешения абсолютного пути Unix
//
Процедура РазрешитьОтносительныйПуть_АбсолютныйПутьUnix() Экспорт
	
	// Подготовка данных - создаем абсолютный путь Unix для тестирования
	ПапкаИмя = ЮТест.Данные().СлучайнаяСтрока(8);
	ФайлИмя = ЮТест.Данные().СлучайнаяСтрока(8);
	Путь = "/" + ПапкаИмя + "/" + ФайлИмя + ".xml";
	WorkspacePath = ЮТест.Данные().СлучайнаяСтрока(20);
	
	// Выполнение
	#Если НЕ ВебКлиент Тогда
		Результат = ЮТПараметрыЗапускаСлужебный.РазрешитьОтносительныйПуть(Путь, WorkspacePath);
		
		// Проверки - абсолютный путь должен вернуться как есть
		ЮТест.ОжидаетЧто(Результат, "РазрешитьОтносительныйПуть абсолютный Unix")
			.Равно(Путь);
	#Иначе
		Результат = ЮТПараметрыЗапускаСлужебный.РазрешитьОтносительныйПуть(Путь, WorkspacePath);
		
		ЮТест.ОжидаетЧто(Результат, "РазрешитьОтносительныйПуть в веб-клиенте")
			.Равно(Путь);
	#КонецЕсли
	
КонецПроцедуры

// Тест разрешения пустого пути
//
Процедура РазрешитьОтносительныйПуть_ПустойПуть() Экспорт
	
	// Подготовка данных
	Путь = "";
	WorkspacePath = ЮТест.Данные().СлучайнаяСтрока(20);
	
	// Выполнение
	#Если НЕ ВебКлиент Тогда
		Результат = ЮТПараметрыЗапускаСлужебный.РазрешитьОтносительныйПуть(Путь, WorkspacePath);
		
		// Проверки - пустой путь должен вернуться как есть
		ЮТест.ОжидаетЧто(Результат, "РазрешитьОтносительныйПуть для пустого пути")
			.Равно("");
	#Иначе
		Результат = ЮТПараметрыЗапускаСлужебный.РазрешитьОтносительныйПуть(Путь, WorkspacePath);
		
		ЮТест.ОжидаетЧто(Результат, "РазрешитьОтносительныйПуть в веб-клиенте")
			.Равно(Путь);
	#КонецЕсли
	
КонецПроцедуры

#КонецОбласти
