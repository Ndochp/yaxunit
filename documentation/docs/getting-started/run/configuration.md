# Конфигурация запуска

Конфигурация настраивается в файле json и может иметь следующие параметры.

## Основные параметры

| Имя параметра     | Тип       | Значение по умолчанию                                   | Описание                                                                                                     |
|-------------------|-----------|---------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|
| `filter`          | `Object`  | [Object, смотрите ниже](#параметры-фильтрации)          | Параметры фильтрации, поиска тестов                                                                          |
| `reportFormat`    | `String`  | `"jUnit"`                                               | Формат отчета о тестировании, возможные значения: `"jUnit"`, `"JSON"` , `"allure"`                           |
| `reports`         | `Array`   | `[]`                                                    | Множественные отчеты. Элемент: объект `\{ "format": "jUnit|allure|...", "path"?: "..." }`. При отсутствии — используется `reportFormat`/`reportPath` (обратная совместимость) |
| `reportPath`      | `String`  | `""`                                                    | Путь к формируемому отчету, можно указать или каталог (в которому будет создан файл отчета) или путь к файлу |
| `closeAfterTests` | `Boolean` | `True`                                                  | Признак закрытия 1С:Предприятие по завершении тестирования                                                   |
| `showReport`      | `Boolean` | `True`                                                  | Открыть форму отчета завершению тестирования                                                                 |
| `logging`         | `Object`  | [Object, смотрите ниже](#параметры-логирования)         | Параметры логирования, подробнее ниже                                                                        |
| `exitCode`        | `String`  | `""`                                                    | Путь к файлу, в который будет записан признак успешного выполнения (0 - успешно, 1 - есть ошибки)            |
| `projectPath`     | `String`  | `""`                                                    | Путь к каталогу проекта, содержащему файлы для тестов                                                        |
| `workspacePath`     | `String`  | `""`                                                    | Базовый каталог для разрешения относительных путей. Имеет приоритет над `projectPath` при разрешении. |
| `rpc`             | `Object`  | [Object, смотрите ниже](#параметры-внешнего-управления) | Параметры подключения к серверу внешнего управления, подробнее ниже                                          |

## Переопределение через командную строку

Начиная с версии `25.09`, YAxUnit поддерживает переопределение параметров конфигурации через командную строку запуска 1С:Предприятия. Это обеспечивает гибкость при настройке CI/CD и запуске тестов в различных окружениях.

### Формат команды

Параметры передаются в формате `ключ=значение`, разделенные точкой с запятой, внутри параметра `/C"RunUnitTests..."`.

```bash
/C"RunUnitTests[=путь_к_файлу.json|true];[параметр1]=[значение1];[параметр2]=[значение2]"
```

- **`RunUnitTests`**: Обязательная часть. Может использоваться как флаг (`RunUnitTests`) или с указанием значения (`RunUnitTests=...`).
	- **Без значения**: `RunUnitTests` эквивалентно `RunUnitTests=true`. Используются настройки по умолчанию с возможностью их переопределения.
	- **Со значением**:
		- `RunUnitTests=путь_к_файлу.json`: Используется указанный конфигурационный файл.
		- `RunUnitTests=true`: Явное указание на использование настроек по умолчанию.
- **`;[параметр]=[значение]`**: Необязательные пары для переопределения.

### Приоритет параметров

Параметры применяются в следующем порядке (каждый последующий уровень переопределяет предыдущий):
1. **Значения по умолчанию**: Встроенные в YAxUnit.
2. **Файл конфигурации `*.json`**: Значения из указанного файла.
3. **Параметры командной строки**: Значения, переданные через `/C"..."`.

### Поддержка относительных путей

Относительные пути в параметрах, таких как `reportPath`, `exitCode`, `logging.file` и `reports[].path`, разрешаются относительно базового каталога.

Логика определения базового каталога (по приоритету):
1. **`workspacePath`**: Если указан, используется его значение.
2. **`projectPath`**: Если `workspacePath` не указан, используется значение `projectPath`.
3. **Текущий каталог**: Если оба вышеуказанных параметра не заданы (каталог, из которого было запущено 1С:Предприятие).

## Параметры фильтрации

| Имя параметра | Тип     | Значение по умолчанию | Описание                                                                            |
|---------------|---------|-----------------------|-------------------------------------------------------------------------------------|
| `extensions`  | `Array` | `["tests"]`           | Список имен расширений, из которых грузятся тесты                                   |
| `modules`     | `Array` | `Null`                | Список имен модулей, из которых грузятся тесты                                      |
| `tests`       | `Array` | `Null`                | Список полных путей к исполняемым тестам (`[имя модуля.имя теста{.Имя контекста}]`) |
| `suites`      | `Array` | `Null`                | Список имен тестовых наборов, которые будут запускаться                             |
| `tags`        | `Array` | `Null`                | Список тегов, которые будут запускаться                                             |
| `contexts`    | `Array` | `Null`                | Список имен контекстов исполнения, в которых будут запускаться тесты                |

## Параметры логирования

| Имя параметра | Тип       | Значение по умолчанию | Описание                                                                                                                       |
|---------------|-----------|-----------------------|--------------------------------------------------------------------------------------------------------------------------------|
| `file`        | `String`  | `""`                  | Путь к файлу лога                                                                                                              |
| `enable`      | `Boolean` | `Null`                | Использование логирвания.<br/>Если не указан, зависит от параметра `file` и `console`, если установлены - вкл, если нет - выкл |
| `console`     | `Boolean` | `false`               | Вывод лога в stdout (консоль)                                                                                                  |
| `level`       | `String`  | `"debug"`             | Уровень детализации лога. Возможные значения: `"debug"`, `"info"`, `"warning"`, `"error"`                                      |

## Параметры внешнего управления

Служебные параметры, для настройки взаимодействия YAxUnit и 1С:EDT.

| Имя параметра | Тип       | Значение по умолчанию | Описание                           |
|---------------|-----------|-----------------------|------------------------------------|
| `enable`      | `Boolean` | `false`               | Использование внешнего управления  |
| `transport`   | `String`  | `"ws"`                | Используемый транспортный протокол |
| `port`        | `Boolean` | `0`                   | Порт сервера                       |
| `key`         | `String`  | `""`                  | Ключ клиента, для рукопожатия      |

## Примеры

1. Запустить тесты расположенные в модулях `МодульТестов1`, `МодульТестов2`, закрыть предприятие по завершении и сохранить отчет в формате `junit`

    ```json
    {
        "filter": {
            "modules": ["МодульТестов1", "МодульТестов2"]
        },
        "reportPath": "C:\\temp\\jUnit\\report.xml",
        "reportFormat": "jUnit",
        "closeAfterTests": true
    }
    ```

2. Запустить все тесты из расширения `YAXUNIT` и сохранить отчет файл `C:\temp\jUnit\report.xml`, остальные параметры будут установлены по умолчанию

    ```json
    {
        "filter": {
            "extensions": ["YAXUNIT"]
        },
        "reportPath": "C:\\temp\\jUnit\\report.xml"
    }
    ```

3. Запустить все тесты с выводом подробного лога в файл, сохранить отчет файл `C:\temp\jUnit\report.xml`

    ```json
    {
        "reportPath": "C:\\temp\\jUnit\\report.xml",
        "logging": {
            "file": "C:\\temp\\jUnit\\tests.log",
            "level": "debug"
        }
    }
    ```

4. Сформировать два отчета: `jUnit` в файл и `Allure` в каталог

    ```json
    {
        "reports": [
            { "format": "jUnit", "path": "C:\\temp\\jUnit\\report.xml" },
            { "format": "allure", "path": "C:\\temp\\allure" }
        ]
    }
    ```
