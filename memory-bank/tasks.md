# Задача: Переопределение конфигурации запуска через параметры запуска 1С (Issue #600)

## Описание проблемы
Нет возможности указывать относительные пути `reportPath` в конфигурации запуска `*.json`. Это создает неудобства при настройке CI/CD и работе в разных окружениях.

## Текущее поведение
- Конфигурация запуска тестов полностью определяется файлом `*.json`
- Нет возможности переопределить параметры через командную строку 1С
- Относительные пути в `reportPath` не поддерживаются
- Параметры командной строки парсятся в функции `ПараметрыЗапускаПредприятия()` в формате `ключ=значение;ключ2=значение2`

## Ожидаемое поведение
- Возможность переопределения параметров конфигурации через параметры запуска 1С
- Поддержка относительных путей для `reportPath` и других путей
- Приоритет параметров командной строки над файлом конфигурации
- **Формат командной строки:** `/C"RunUnitTests=config.json;reportPath=./reports;reportFormat=allure"`

## Технические детали
- **Milestone:** YAxUnit 25.05
- **Тип:** Feature (новая функциональность)
- **Метки:** Запуск, Функциональность по запуску тестов
- **Ссылка:** [Issue #600](https://github.com/bia-technologies/yaxunit/issues/600)

## Анализ текущей архитектуры

### Ключевые модули
1. **`ЮТПараметрыЗапускаСлужебный`** - основной модуль парсинга параметров
2. **`ЮТФабрика.ПараметрыЗапуска()`** - структура параметров запуска
3. **`ЮТНастройкиВыполнения`** - модуль настроек выполнения

### Текущий алгоритм
1. `ПараметрЗапуска` разбирается в функции `ПараметрыЗапускаПредприятия()` на пары `ключ=значение`
2. Ищется ключ `RunUnitTests` (регистронезависимо)
3. Если значение - строка, то это путь к JSON файлу конфигурации
4. Если значение - булево `true`, то используются настройки по умолчанию
5. JSON файл читается функцией `ПрочитатьКонфигурационныйФайл()`
6. Параметры дополняются в функции `ДополнитьПараметрыПрочитанными()`

### Поддерживаемые параметры
- `reportPath` - путь к отчету (строка)
- `reportFormat` - формат отчета (jUnit, JSON, allure)
- `reports` - массив множественных отчетов
- `closeAfterTests` - закрытие после тестов (булево)
- `showReport` - показать отчет (булево)
- `filter` - параметры фильтрации (объект)
- `logging` - параметры логирования (объект)
- `exitCode` - файл кода выхода (строка)
- `projectPath` - путь к проекту (строка)

## План выполнения

### ✅ Этап 1: Анализ текущей архитектуры
1. ✅ Изучить код обработки конфигурации запуска
2. ✅ Определить места где читается конфигурация
3. ✅ Проанализировать структуру параметров запуска

### Этап 2: Разработка механизма переопределения
1. **Расширить парсинг параметров командной строки**
   - Модифицировать функцию `ПереданныеПараметрыТестирования()` для обработки дополнительных параметров
   - Добавить поддержку формата: `RunUnitTests=config.json;reportPath=./reports;reportFormat=allure`
   - Создать функцию `ПарсингДополнительныхПараметров(ПараметрыЗапускаПредприятия)`

2. **Реализовать логику слияния параметров**
   - Создать функцию `СлитьПараметры(ПараметрыИзФайла, ПараметрыИзКоманднойСтроки)`
   - Обеспечить приоритет: CLI > файл > умолчания
   - Поддержать простые параметры (строки, булево, числа)
   - Подготовить архитектуру для будущих источников (переменные среды, дополнительный файл)

3. **Добавить поддержку относительных путей**
   - Добавить параметр `workspacePath` в структуру `ПараметрыЗапуска()`
   - Создать функцию `РазрешитьОтносительныйПуть(Путь, workspacePath, projectPath)`
   - Логика разрешения: если указан `workspacePath` → используем его, иначе `projectPath`, иначе текущий каталог
   - Применить к параметрам: `reportPath`, `logging.file`, `exitCode`, `projectPath`, `reports[].path`

### Этап 3: Создание тестов
1. **Тесты парсинга дополнительных параметров**
   - `ТестПарсингаДополнительныхПараметров()`
   - `ТестОбработкиСмешанныхПараметров()` (файл + переопределения)
   - `ТестОбработкиНеправильныхПараметров()`

2. **Тесты слияния параметров**
   - `ТестПриоритетаПараметровКоманднойСтроки()`
   - `ТестОбратнойСовместимости()`
   - `ТестПереопределенияПростыхПараметров()`

3. **Тесты относительных путей**
   - `ТестРазрешенияОтносительныхПутей_WorkspacePath()`
   - `ТестРазрешенияОтносительныхПутей_ProjectPath()`
   - `ТестРазрешенияОтносительныхПутей_ТекущийКаталог()`
   - `ТестПриоритетаБазовыхКаталогов()`
   - `ТестАбсолютныхПутей()`

### Этап 4: Документация
1. Обновить `documentation/docs/getting-started/run/configuration.md`
2. Добавить описание нового параметра `workspacePath`
3. Добавить примеры использования параметров командной строки
4. Описать логику разрешения относительных путей

## Формат параметров командной строки

### Основной формат (утвержден)
```
/Execute ЮТест /C"RunUnitTests=config.json;reportPath=./reports;reportFormat=allure"
```

### Примеры использования
1. **Только переопределения без файла:**
   ```
   /Execute ЮТест /C"RunUnitTests=true;reportPath=./reports;reportFormat=allure"
   ```

2. **Файл конфигурации + переопределения:**
   ```
   /Execute ЮТест /C"RunUnitTests=config.json;reportPath=./reports;workspacePath=/workspace"
   ```

3. **Множественные параметры:**
   ```
   /Execute ЮТест /C"RunUnitTests=config.json;reportPath=./reports;closeAfterTests=false;showReport=true"
   ```

## Приоритет параметров (от высшего к низшему)
1. **Параметры командной строки** (после `;`)
2. **Файл конфигурации JSON**
3. **Значения по умолчанию**

*В будущем планируется:*
4. **Переменные среды** (между CLI и файлом)
5. **Дополнительный файл конфигурации** (между переменными и основным файлом)

## Относительные пути

### Логика разрешения (по приоритету)
1. **`workspacePath`** - если указан этот параметр
2. **`projectPath`** - если указан и нет `workspacePath`
3. **Текущий каталог** - если не указаны предыдущие

### Поддерживаемые параметры
- `reportPath`
- `logging.file`
- `exitCode` 
- `projectPath` (сам себя не разрешает)
- `reports[].path`

### Новый параметр
- `workspacePath` - Строка - Базовый каталог для разрешения относительных путей

## Файлы для изменения

### Основные модули
- `exts/yaxunit/src/CommonModules/ЮТПараметрыЗапускаСлужебный/Module.bsl`
  - Модифицировать функцию `ПереданныеПараметрыТестирования()`
  - Добавить функцию `ПарсингДополнительныхПараметров()`
  - Добавить функцию `СлитьПараметры()`
  - Добавить функцию `РазрешитьОтносительныйПуть()`

- `exts/yaxunit/src/CommonModules/ЮТФабрика/Module.bsl`
  - Добавить параметр `workspacePath` в функцию `ПараметрыЗапуска()`

### Тесты
- `tests/src/CommonModules/ОМ_ЮТПараметрыЗапускаСлужебный/` - новый модуль тестов
- Тесты для проверки парсинга дополнительных параметров
- Тесты для проверки приоритетов
- Тесты для логики разрешения относительных путей

### Документация
- `documentation/docs/getting-started/run/configuration.md`

## Критерии приемки
1. ⏳ Параметры командной строки могут переопределить настройки из JSON файла
2. ⏳ Поддержка формата `RunUnitTests=config.json;reportPath=./reports;reportFormat=allure`
3. ⏳ Поддержка нового параметра `workspacePath`
4. ⏳ Логика разрешения относительных путей: workspacePath → projectPath → текущий каталог
5. ⏳ Обратная совместимость с существующими конфигурациями
6. ⏳ Документация обновлена с примерами использования
7. ⏳ Покрытие тестами новой функциональности не менее 80%
8. ⏳ Архитектура готова для будущих источников параметров

## Приоритет
**Высокий** - функциональность критична для удобства CI/CD интеграции и работы в разных окружениях.

## Связанные ресурсы
- [Issue #600](https://github.com/bia-technologies/yaxunit/issues/600)
- Milestone: YAxUnit 25.05

## Статус
⏳ В работе

## Текущий прогресс
- ✅ Создана ветка `feature/600-override-launch-config`
- ✅ Проанализирована задача
- ✅ Изучена текущая архитектура
- ✅ Определены ключевые модули и функции
- ✅ Уточнены требования к формату параметров и относительным путям
- ✅ Составлен детальный план реализации
- ⏳ Начало разработки
